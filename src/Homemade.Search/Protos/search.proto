syntax = "proto3";
import "google/protobuf/duration.proto";
import "models.proto";

option csharp_namespace = "Homemade.Grpc";

package search;

// The recipe search service definition.
service RecipeSearch {
	// Searches for recipes matching the given criteria
	rpc Search (RecipeQuery) returns (RecipeResults);

	// Allows streaming multiple queries over the same connection.
	rpc LiveSearch (stream RecipeQuery) returns (stream RecipeResults);
}

// The request message containing the search query.
message RecipeQuery {
	optional PaginationRequest pagination = 1;

	// The text the user entered in the free-text search box (if any).
	optional string searchText = 2;

	// A list of tags that the recipes should have.
	repeated string Tags = 3;

	// An optional difficulty to filter the recipes with.
	optional int32 Difficulty = 4;

	// If set only shows recipes whose cooking time is longer than this.
	optional google.protobuf.Duration MinCookingTime = 5;

	// If set only shows recipes whose cooking time is less than this.
	optional int32 MaxCookingTime = 6;
}

// The response message containing a single search result.
message RecipeResults {
	// Contains pagination information about the response.
	Pagination pagination = 1;

	// The recipes matching the requested query.
	repeated RecipeResult recipes = 2;

	// The tags facets for the results.
	repeated FacetValue tags = 3;

	// The ingredient facets for the results.
	repeated FacetValue ingredients = 4;
}

// Represents a single recipe search result.
message RecipeResult {
	// The ID of the recipe, used for linking and fetching information.
	int64 id = 1;

	// The name of the recipe.
	string name = 2;

	// The icon (if any) of the recipe.
	optional string icon = 3;

	// A list of the tags associated with this recipe.
	repeated string tags = 4;

	// The total time it takes to prepare this recipe.
	google.protobuf.Duration totalTimeMinutes = 5;

	// The amount of people this recipe can serve.
	int32 servings = 6;

	// The difficulty of this recipe.
	RecipeDifficulty difficulty = 7;

	// The amount of ingredients required for this recipe.
	int32 ingredientCount = 8;
}

// How difficult the recipe is (relatively).
enum RecipeDifficulty {
	// The difficulty of the recipe was unspecified or a value not recognised.
	Unknown = 0;
}
